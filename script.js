!function(e){var t={};function o(n){if(t[n])return t[n].exports;var l=t[n]={i:n,l:!1,exports:{}};return e[n].call(l.exports,l,l.exports,o),l.l=!0,l.exports}o.m=e,o.c=t,o.d=function(e,t,n){o.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},o.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},o.t=function(e,t){if(1&t&&(e=o(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(o.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)o.d(n,l,function(t){return e[t]}.bind(null,l));return n},o.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return o.d(t,"a",t),t},o.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},o.p="",o(o.s=1)}([function(e,t,o){},function(e,t,o){o(2),e.exports=o(0)},function(e,t,o){"use strict";o.r(t);o(0),o(3),o(4),o(5),o(6);const n={x:0,y:0,tool:"pencil"},l={size:128},c={currentColor:"#FFC107",prevColor:"#FFEB3B",red:"#F74141",blue:"#00BCD4"};document.getElementById("current").style.backgroundColor=`${c.currentColor}`,document.getElementById("previous").style.backgroundColor=`${c.prevColor}`,document.getElementById("red").style.backgroundColor=`${c.red}`,document.getElementById("blue").style.backgroundColor=`${c.blue}`;const a=document.getElementById("palette"),r=a.getContext("2d");function u(e){r.imageSmoothingEnabled=!1,r.webkitImageSmoothingEnabled=!1;const t=e,o=localStorage.getItem("canvas"),n=new Image;n.src=o,n.onload=function(){a.width=t,a.height=t,r.drawImage(n,0,0,t,t),localStorage.setItem("canvas",document.getElementById("palette").toDataURL())}}function d(){return a.onmousemove=null,localStorage.setItem("canvas",document.getElementById("palette").toDataURL()),localStorage.setItem("width",r.canvas.width),null}function s(e){const t=document.getElementById("current");c.prevColor=c.currentColor;const o=document.getElementById("previous");return c.currentColor=e,t.style.background=e,o.style.background=c.prevColor,c.currentColor}r.canvas.width=128,r.canvas.height=128,r.fillStyle="white",r.fillRect(0,0,512,512),document.querySelector(".tools__list").addEventListener("click",e=>{n.tool=e.target.id;const t=e.target;document.body.style.cursor=`url('./src/blocks/main/${n.tool}.svg'), auto`,null!==document.querySelector(".active")&&(document.querySelector(".active").className="list__item"),t.parentNode.className="list__item active"}),a.onmousedown=function(e){if(r.fillStyle=c.currentColor,"pencil"===n.tool){let t=e.offsetX,o=e.offsetY;a.onmousemove=function(e){const n=e.offsetX,l=e.offsetY;!function(){const e=Math.abs(n-t),c=Math.abs(l-o),a=t<n?1:-1,u=o<l?1:-1;let d=e-c;for(;t;){const s=Math.floor(t*r.canvas.width/512),i=Math.floor(o*r.canvas.height/512);if(r.fillRect(s,i,1,1),r.fill(),t===n&&o===l)break;const m=2*d;m>-c&&(d-=c,t+=+a),m<e&&(d+=e,o+=+u)}}()},a.onmouseup=d}"bucket"===n.tool&&(r.fillStyle=`${c.currentColor}`,r.fillRect(0,0,r.canvas.width,r.canvas.height),localStorage.setItem("canvas",document.getElementById("palette").toDataURL()),localStorage.setItem("width",r.canvas.width))},document.getElementById("curColor").oninput=()=>{s(document.getElementById("curColor").value)},document.getElementById("current").addEventListener("click",()=>{s(document.getElementById("current").style.backgroundColor)}),document.getElementById("previous").addEventListener("click",()=>{s(document.getElementById("previous").style.backgroundColor)}),document.getElementById("red").addEventListener("click",()=>{s(document.getElementById("red").style.backgroundColor)}),document.getElementById("blue").addEventListener("click",()=>{s(document.getElementById("blue").style.backgroundColor)}),document.addEventListener("keydown",e=>{switch(e.code){case"KeyC":document.getElementById("curColor").click();break;case"KeyV":n.tool="pencil",document.getElementById("pencil").click();break;case"KeyB":n.tool="bucket",document.getElementById("bucket").click()}}),document.getElementById("load").addEventListener("click",async()=>{const e=new Image;e.crossOrigin="anonymous";const t=`https://api.unsplash.com/photos/random?query=town,${document.getElementById("search").value}&client_id=9a97d3fa2e93eeb1f8c028963896a447f1b5c7316248e00ef490d65df1d10d2e`;await fetch(t).then(e=>e.json()).then(t=>{e.src=t.urls.small,localStorage.setItem("image",e.src),e.onload=function(){if(e.width>=e.height){r.canvas.width=l.size;const t=l.size*(e.height/e.width),o=(l.size-t)/2;r.drawImage(e,0,o,r.canvas.width,t),localStorage.setItem("canvas",document.getElementById("palette").toDataURL()),localStorage.setItem("width",r.canvas.width)}else{r.canvas.height=l.size;const t=l.size*(e.width/e.height),o=(l.size-t)/2;r.drawImage(e,o,0,t,r.canvas.height),localStorage.setItem("canvas",document.getElementById("palette").toDataURL()),localStorage.setItem("width",r.canvas.width)}}})});const i=document.querySelector(".input-range__number"),m=document.querySelector(".input-range__value");if(document.getElementById("value").innerText=`${l.size}`,i.oninput=function(){switch(`${this.value}`){case"1":document.getElementById("value").innerText="4",m.style.left="-15px",l.size=4,u(4);break;case"2":document.getElementById("value").innerText=" 32",m.style.left="150px",l.size=32,u(32);break;case"3":document.getElementById("value").innerText="128",m.style.left="315px",l.size=128,u(128);break;case"4":document.getElementById("value").innerText="256",m.style.left="480px",l.size=256,u(256)}},document.getElementById("grayscale").addEventListener("click",()=>{const e=localStorage.getItem("width"),t=r.getImageData(0,0,e,e),o=r.createImageData(e,e),n=t.data,l=o.data;let c;for(let e=0;e<n.length;e+=4)c=.2126*n[e]+.7152*n[e+1]+.0722*n[e+2],l[e]=c,l[e+1]=c,l[e+2]=c,l[e+3]=n[e+3];r.putImageData(o,0,0),localStorage.setItem("canvas",document.getElementById("palette").toDataURL())}),null!==localStorage.getItem("mouse")&&window.confirm("Восстановить данные предыдущей сессии?")){const e=localStorage.getItem("width"),t=localStorage.getItem("canvas"),o=new Image;o.src=t,o.onload=function(){a.width=e,a.height=e,r.drawImage(o,0,0)},n.tool=localStorage.getItem("mouse"),s(localStorage.getItem("previousColor")),s(localStorage.getItem("currentColor")),document.body.style.cursor=`url('./src/blocks/main/${n.tool}.svg'), auto`,document.getElementById(n.tool).parentNode.className="list__item active",document.querySelector(".main__canvas").style.imageRendering="pixelated"}window.onunload=function(){localStorage.setItem("mouse",n.tool),localStorage.setItem("currentColor",document.getElementById("current").style.backgroundColor),localStorage.setItem("previousColor",document.getElementById("previous").style.backgroundColor),localStorage.setItem("input-range",l.size)},document.getElementById(`${n.tool}`).click()},function(e,t,o){},function(e,t,o){},function(e,t,o){},function(e,t,o){}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAiLCJ3ZWJwYWNrOi8vLy4vc3JjL2luZGV4LmpzIl0sIm5hbWVzIjpbImluc3RhbGxlZE1vZHVsZXMiLCJfX3dlYnBhY2tfcmVxdWlyZV9fIiwibW9kdWxlSWQiLCJleHBvcnRzIiwibW9kdWxlIiwiaSIsImwiLCJtb2R1bGVzIiwiY2FsbCIsIm0iLCJjIiwiZCIsIm5hbWUiLCJnZXR0ZXIiLCJvIiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJlbnVtZXJhYmxlIiwiZ2V0IiwiciIsIlN5bWJvbCIsInRvU3RyaW5nVGFnIiwidmFsdWUiLCJ0IiwibW9kZSIsIl9fZXNNb2R1bGUiLCJucyIsImNyZWF0ZSIsImtleSIsImJpbmQiLCJuIiwib2JqZWN0IiwicHJvcGVydHkiLCJwcm90b3R5cGUiLCJoYXNPd25Qcm9wZXJ0eSIsInAiLCJzIiwibW91c2UiLCJ4IiwieSIsInRvb2wiLCJpbnB1dCIsInNpemUiLCJjb2xvcnMiLCJjdXJyZW50Q29sb3IiLCJwcmV2Q29sb3IiLCJyZWQiLCJibHVlIiwiZG9jdW1lbnQiLCJnZXRFbGVtZW50QnlJZCIsInN0eWxlIiwiYmFja2dyb3VuZENvbG9yIiwiY2FudmFzIiwiY3R4IiwiZ2V0Q29udGV4dCIsImRyYXdGcm9tU3RvcmFnZSIsIndpZHRoIiwiaW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwid2Via2l0SW1hZ2VTbW9vdGhpbmdFbmFibGVkIiwiZGF0YVVSTCIsImxvY2FsU3RvcmFnZSIsImdldEl0ZW0iLCJpbWdEYXRhIiwiSW1hZ2UiLCJzcmMiLCJvbmxvYWQiLCJoZWlnaHQiLCJkcmF3SW1hZ2UiLCJzZXRJdGVtIiwidG9EYXRhVVJMIiwibW91c2VVcCIsIm9ubW91c2Vtb3ZlIiwiY2hhbmdlQ29sb3IiLCJjb2xvciIsImN1cnIiLCJwcmV2IiwiYmFja2dyb3VuZCIsImZpbGxTdHlsZSIsImZpbGxSZWN0IiwicXVlcnlTZWxlY3RvciIsImFkZEV2ZW50TGlzdGVuZXIiLCJldmVudCIsInRhcmdldCIsImlkIiwiZWxlbSIsImJvZHkiLCJjdXJzb3IiLCJjbGFzc05hbWUiLCJwYXJlbnROb2RlIiwib25tb3VzZWRvd24iLCJ4MCIsIm9mZnNldFgiLCJ5MCIsIm9mZnNldFkiLCJuZXdFdmVudCIsIngxIiwieTEiLCJkeCIsIk1hdGgiLCJhYnMiLCJkeSIsInN4Iiwic3kiLCJlcnIiLCJmaWxsWCIsImZsb29yIiwiZmlsbFkiLCJmaWxsIiwiZTIiLCJsaW5lIiwib25tb3VzZXVwIiwib25pbnB1dCIsImNvZGUiLCJjbGljayIsImFzeW5jIiwiaW1nIiwiY3Jvc3NPcmlnaW4iLCJ1cmwiLCJmZXRjaCIsInRoZW4iLCJyZXMiLCJqc29uIiwiZGF0YSIsInVybHMiLCJzbWFsbCIsInN0YXJ0WSIsInN0YXJ0WCIsInJhbmdlIiwiaW5uZXJUZXh0IiwidGhpcyIsImxlZnQiLCJpbWFnZURhdGEiLCJnZXRJbWFnZURhdGEiLCJibGFja0ltYWdlIiwiY3JlYXRlSW1hZ2VEYXRhIiwic291cmNlRGF0YSIsImJsYWNrRGF0YSIsImx1bWEiLCJsZW5ndGgiLCJwdXRJbWFnZURhdGEiLCJ3aW5kb3ciLCJjb25maXJtIiwiaW1hZ2VSZW5kZXJpbmciLCJvbnVubG9hZCJdLCJtYXBwaW5ncyI6ImFBQ0UsSUFBSUEsRUFBbUIsR0FHdkIsU0FBU0MsRUFBb0JDLEdBRzVCLEdBQUdGLEVBQWlCRSxHQUNuQixPQUFPRixFQUFpQkUsR0FBVUMsUUFHbkMsSUFBSUMsRUFBU0osRUFBaUJFLEdBQVksQ0FDekNHLEVBQUdILEVBQ0hJLEdBQUcsRUFDSEgsUUFBUyxJQVVWLE9BTkFJLEVBQVFMLEdBQVVNLEtBQUtKLEVBQU9ELFFBQVNDLEVBQVFBLEVBQU9ELFFBQVNGLEdBRy9ERyxFQUFPRSxHQUFJLEVBR0pGLEVBQU9ELFFBS2ZGLEVBQW9CUSxFQUFJRixFQUd4Qk4sRUFBb0JTLEVBQUlWLEVBR3hCQyxFQUFvQlUsRUFBSSxTQUFTUixFQUFTUyxFQUFNQyxHQUMzQ1osRUFBb0JhLEVBQUVYLEVB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VW5JLEVBQUksR0FBS2tJLEVBQVdsSSxFQUFJLEdBRXBDZ0QsRUFBSXNGLGFBQWFOLEVBQVksRUFBRyxHQUNoQ3pFLGFBQWFRLFFBQVEsU0FBVXBCLFNBQVNDLGVBQWUsV0FBV29CLGVBSTlCLE9BQWxDVCxhQUFhQyxRQUFRLFVBQXFCK0UsT0FBT0MsUUFBUSwwQ0FBMkMsQ0FDdEcsTUFBTXJGLEVBQVFJLGFBQWFDLFFBQVEsU0FDN0JGLEVBQVVDLGFBQWFDLFFBQVEsVUFDL0JDLEVBQVUsSUFBSUMsTUFDcEJELEVBQVFFLElBQU1MLEVBQ2RHLEVBQVFHLE9BQVMsV0FDZmIsRUFBT0ksTUFBUUEsRUFDZkosRUFBT2MsT0FBU1YsRUFDaEJILEVBQUljLFVBQVVMLEVBQVMsRUFBRyxJQUc1QnpCLEVBQU1HLEtBQU9vQixhQUFhQyxRQUFRLFNBQ2xDVyxFQUFZWixhQUFhQyxRQUFRLGtCQUNqQ1csRUFBWVosYUFBYUMsUUFBUSxpQkFDakNiLFNBQVNxQyxLQUFLbkMsTUFBTW9DLE9BQVUsMEJBQXlCakQsRUFBTUcsbUJBQzdEUSxTQUFTQyxlQUFlWixFQUFNRyxNQUFNZ0QsV0FBV0QsVUFBWSxvQkFDM0R2QyxTQUFTK0IsY0FBYyxpQkFBaUI3QixNQUFNNEYsZUFBaUIsWUFHakVGLE9BQU9HLFNBQVcsV0FDaEJuRixhQUFhUSxRQUFRLFFBQVMvQixFQUFNRyxNQUNwQ29CLGFBQWFRLFFBQVEsZUFBZ0JwQixTQUFTQyxlQUFlLFdBQVdDLE1BQU1DLGlCQUM5RVMsYUFBYVEsUUFBUSxnQkFBaUJwQixTQUFTQyxlQUFlLFlBQVlDLE1BQU1DLGlCQUNoRlMsYUFBYVEsUUFBUSxjQUFlM0IsRUFBTUMsT0FJNUNNLFNBQVNDLGVBQWdCLEdBQUVaLEVBQU1HLFFBQVF5RSxTIiwiZmlsZSI6InNjcmlwdC5qcyIsInNvdXJjZXNDb250ZW50IjpbIiBcdC8vIFRoZSBtb2R1bGUgY2FjaGVcbiBcdHZhciBpbnN0YWxsZWRNb2R1bGVzID0ge307XG5cbiBcdC8vIFRoZSByZXF1aXJlIGZ1bmN0aW9uXG4gXHRmdW5jdGlvbiBfX3dlYnBhY2tfcmVxdWlyZV9fKG1vZHVsZUlkKSB7XG5cbiBcdFx0Ly8gQ2hlY2sgaWYgbW9kdWxlIGlzIGluIGNhY2hlXG4gXHRcdGlmKGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdKSB7XG4gXHRcdFx0cmV0dXJuIGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdLmV4cG9ydHM7XG4gXHRcdH1cbiBcdFx0Ly8gQ3JlYXRlIGEgbmV3IG1vZHVsZSAoYW5kIHB1dCBpdCBpbnRvIHRoZSBjYWNoZSlcbiBcdFx0dmFyIG1vZHVsZSA9IGluc3RhbGxlZE1vZHVsZXNbbW9kdWxlSWRdID0ge1xuIFx0XHRcdGk6IG1vZHVsZUlkLFxuIFx0XHRcdGw6IGZhbHNlLFxuIFx0XHRcdGV4cG9ydHM6IHt9XG4gXHRcdH07XG5cbiBcdFx0Ly8gRXhlY3V0ZSB0aGUgbW9kdWxlIGZ1bmN0aW9uXG4gXHRcdG1vZHVsZXNbbW9kdWxlSWRdLmNhbGwobW9kdWxlLmV4cG9ydHMsIG1vZHVsZSwgbW9kdWxlLmV4cG9ydHMsIF9fd2VicGFja19yZXF1aXJlX18pO1xuXG4gXHRcdC8vIEZsYWcgdGhlIG1vZHVsZSBhcyBsb2FkZWRcbiBcdFx0bW9kdWxlLmwgPSB0cnVlO1xuXG4gXHRcdC8vIFJldHVybiB0aGUgZXhwb3J0cyBvZiB0aGUgbW9kdWxlXG4gXHRcdHJldHVybiBtb2R1bGUuZXhwb3J0cztcbiBcdH1cblxuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZXMgb2JqZWN0IChfX3dlYnBhY2tfbW9kdWxlc19fKVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5tID0gbW9kdWxlcztcblxuIFx0Ly8gZXhwb3NlIHRoZSBtb2R1bGUgY2FjaGVcbiBcdF9fd2VicGFja19yZXF1aXJlX18uYyA9IGluc3RhbGxlZE1vZHVsZXM7XG5cbiBcdC8vIGRlZmluZSBnZXR0ZXIgZnVuY3Rpb24gZm9yIGhhcm1vbnkgZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5kID0gZnVuY3Rpb24oZXhwb3J0cywgbmFtZSwgZ2V0dGVyKSB7XG4gXHRcdGlmKCFfX3dlYnBhY2tfcmVxdWlyZV9fLm8oZXhwb3J0cywgbmFtZSkpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgbmFtZSwgeyBlbnVtZXJhYmxlOiB0cnVlLCBnZXQ6IGdldHRlciB9KTtcbiBcdFx0fVxuIFx0fTtcblxuIFx0Ly8gZGVmaW5lIF9fZXNNb2R1bGUgb24gZXhwb3J0c1xuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yID0gZnVuY3Rpb24oZXhwb3J0cykge1xuIFx0XHRpZih0eXBlb2YgU3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiBTeW1ib2wudG9TdHJpbmdUYWcpIHtcbiBcdFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgU3ltYm9sLnRvU3RyaW5nVGFnLCB7IHZhbHVlOiAnTW9kdWxlJyB9KTtcbiBcdFx0fVxuIFx0XHRPYmplY3QuZGVmaW5lUHJvcGVydHkoZXhwb3J0cywgJ19fZXNNb2R1bGUnLCB7IHZhbHVlOiB0cnVlIH0pO1xuIFx0fTtcblxuIFx0Ly8gY3JlYXRlIGEgZmFrZSBuYW1lc3BhY2Ugb2JqZWN0XG4gXHQvLyBtb2RlICYgMTogdmFsdWUgaXMgYSBtb2R1bGUgaWQsIHJlcXVpcmUgaXRcbiBcdC8vIG1vZGUgJiAyOiBtZXJnZSBhbGwgcHJvcGVydGllcyBvZiB2YWx1ZSBpbnRvIHRoZSBuc1xuIFx0Ly8gbW9kZSAmIDQ6IHJldHVybiB2YWx1ZSB3aGVuIGFscmVhZHkgbnMgb2JqZWN0XG4gXHQvLyBtb2RlICYgOHwxOiBiZWhhdmUgbGlrZSByZXF1aXJlXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLnQgPSBmdW5jdGlvbih2YWx1ZSwgbW9kZSkge1xuIFx0XHRpZihtb2RlICYgMSkgdmFsdWUgPSBfX3dlYnBhY2tfcmVxdWlyZV9fKHZhbHVlKTtcbiBcdFx0aWYobW9kZSAmIDgpIHJldHVybiB2YWx1ZTtcbiBcdFx0aWYoKG1vZGUgJiA0KSAmJiB0eXBlb2YgdmFsdWUgPT09ICdvYmplY3QnICYmIHZhbHVlICYmIHZhbHVlLl9fZXNNb2R1bGUpIHJldHVybiB2YWx1ZTtcbiBcdFx0dmFyIG5zID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiBcdFx0X193ZWJwYWNrX3JlcXVpcmVfXy5yKG5zKTtcbiBcdFx0T2JqZWN0LmRlZmluZVByb3BlcnR5KG5zLCAnZGVmYXVsdCcsIHsgZW51bWVyYWJsZTogdHJ1ZSwgdmFsdWU6IHZhbHVlIH0pO1xuIFx0XHRpZihtb2RlICYgMiAmJiB0eXBlb2YgdmFsdWUgIT0gJ3N0cmluZycpIGZvcih2YXIga2V5IGluIHZhbHVlKSBfX3dlYnBhY2tfcmVxdWlyZV9fLmQobnMsIGtleSwgZnVuY3Rpb24oa2V5KSB7IHJldHVybiB2YWx1ZVtrZXldOyB9LmJpbmQobnVsbCwga2V5KSk7XG4gXHRcdHJldHVybiBucztcbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cblxuIFx0Ly8gTG9hZCBlbnRyeSBtb2R1bGUgYW5kIHJldHVybiBleHBvcnRzXG4gXHRyZXR1cm4gX193ZWJwYWNrX3JlcXVpcmVfXyhfX3dlYnBhY2tfcmVxdWlyZV9fLnMgPSAxKTtcbiIsImltcG9ydCAnLi9zdHlsZS5zY3NzJztcbmltcG9ydCAnLi9ibG9ja3MvaGVhZGVyL2hlYWRlci5zY3NzJztcbmltcG9ydCAnLi90eXBvZ3JhcGh5L2ZvbnRzLnNjc3MnO1xuaW1wb3J0ICcuL2Jsb2Nrcy9tYWluL21haW4uc2Nzcyc7XG5pbXBvcnQgJy4vbWl4aW4uc2Nzcyc7XG5cbmNvbnN0IG1vdXNlID0ge1xuICB4OiAwLFxuICB5OiAwLFxuICB0b29sOiAncGVuY2lsJyxcbn07XG5cbmNvbnN0IGlucHV0ID0ge1xuICBzaXplOiAxMjgsXG59O1xuXG5cbmNvbnN0IGNvbG9ycyA9IHtcbiAgY3VycmVudENvbG9yOiAnI0ZGQzEwNycsXG4gIHByZXZDb2xvcjogJyNGRkVCM0InLFxuICByZWQ6ICcjRjc0MTQxJyxcbiAgYmx1ZTogJyMwMEJDRDQnLFxufTtcblxuLy8gY29uc3Qga2V5ID0gJzFhZWQ1MTM0ZDU5M2JjYmIzNjA2ZWJkOWNhMTUzYWRiNmI1MmFhZDc0NjcyM2JkYzNkNGYyM2ZhM2U2M2I5YjgnO1xuY29uc3Qga2V5ID0gJzlhOTdkM2ZhMmU5M2VlYjFmOGMwMjg5NjM4OTZhNDQ3ZjFiNWM3MzE2MjQ4ZTAwZWY0OTBkNjVkZjFkMTBkMmUnO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBgJHtjb2xvcnMuY3VycmVudENvbG9yfWA7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlvdXMnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBgJHtjb2xvcnMucHJldkNvbG9yfWA7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncmVkJykuc3R5bGUuYmFja2dyb3VuZENvbG9yID0gYCR7Y29sb3JzLnJlZH1gO1xuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWUnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IgPSBgJHtjb2xvcnMuYmx1ZX1gO1xuXG5jb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFsZXR0ZScpO1xuY29uc3QgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XG5jdHguY2FudmFzLndpZHRoID0gMTI4O1xuY3R4LmNhbnZhcy5oZWlnaHQgPSAxMjg7XG5jdHguZmlsbFN0eWxlID0gJ3doaXRlJztcbmN0eC5maWxsUmVjdCgwLCAwLCA1MTIsIDUxMik7XG5cblxuZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLnRvb2xzX19saXN0JykuYWRkRXZlbnRMaXN0ZW5lcignY2xpY2snLCAoZXZlbnQpID0+IHtcbiAgbW91c2UudG9vbCA9IGV2ZW50LnRhcmdldC5pZDtcbiAgY29uc3QgZWxlbSA9IGV2ZW50LnRhcmdldDtcbiAgZG9jdW1lbnQuYm9keS5zdHlsZS5jdXJzb3IgPSBgdXJsKCcuL3NyYy9ibG9ja3MvbWFpbi8ke21vdXNlLnRvb2x9LnN2ZycpLCBhdXRvYDtcbiAgaWYgKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY3RpdmUnKSAhPT0gbnVsbCkge1xuICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoJy5hY3RpdmUnKS5jbGFzc05hbWUgPSAnbGlzdF9faXRlbSc7XG4gIH1cbiAgZWxlbS5wYXJlbnROb2RlLmNsYXNzTmFtZSA9ICdsaXN0X19pdGVtIGFjdGl2ZSc7XG59KTtcblxuZnVuY3Rpb24gZHJhd0Zyb21TdG9yYWdlKHdpZHRoKSB7XG4gIGN0eC5pbWFnZVNtb290aGluZ0VuYWJsZWQgPSBmYWxzZTtcbiAgY3R4LndlYmtpdEltYWdlU21vb3RoaW5nRW5hYmxlZCA9IGZhbHNlO1xuICBjb25zdCBzaXplID0gd2lkdGg7XG4gIGNvbnN0IGRhdGFVUkwgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnY2FudmFzJyk7XG4gIGNvbnN0IGltZ0RhdGEgPSBuZXcgSW1hZ2UoKTtcbiAgaW1nRGF0YS5zcmMgPSBkYXRhVVJMO1xuICBpbWdEYXRhLm9ubG9hZCA9IGZ1bmN0aW9uICgpIHtcbiAgICBjYW52YXMud2lkdGggPSBzaXplO1xuICAgIGNhbnZhcy5oZWlnaHQgPSBzaXplO1xuICAgIGN0eC5kcmF3SW1hZ2UoaW1nRGF0YSwgMCwgMCwgc2l6ZSwgc2l6ZSk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhbnZhcycsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWxldHRlJykudG9EYXRhVVJMKCkpO1xuICB9O1xufVxuXG5mdW5jdGlvbiBtb3VzZVVwKCkge1xuICBjYW52YXMub25tb3VzZW1vdmUgPSBudWxsO1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FudmFzJywgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbGV0dGUnKS50b0RhdGFVUkwoKSk7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd3aWR0aCcsIGN0eC5jYW52YXMud2lkdGgpO1xuICByZXR1cm4gbnVsbDtcbn1cblxuY2FudmFzLm9ubW91c2Vkb3duID0gZnVuY3Rpb24gdG9vbERyYXcoZXZlbnQpIHtcbiAgY3R4LmZpbGxTdHlsZSA9IGNvbG9ycy5jdXJyZW50Q29sb3I7XG4gIGlmIChtb3VzZS50b29sID09PSAncGVuY2lsJykge1xuICAgIGxldCB4MCA9IGV2ZW50Lm9mZnNldFg7XG4gICAgbGV0IHkwID0gZXZlbnQub2Zmc2V0WTtcblxuICAgIGNhbnZhcy5vbm1vdXNlbW92ZSA9IGZ1bmN0aW9uIGJyZXoobmV3RXZlbnQpIHtcbiAgICAgIGNvbnN0IHgxID0gbmV3RXZlbnQub2Zmc2V0WDtcbiAgICAgIGNvbnN0IHkxID0gbmV3RXZlbnQub2Zmc2V0WTtcbiAgICAgIGZ1bmN0aW9uIGxpbmUoKSB7XG4gICAgICAgIGNvbnN0IGR4ID0gTWF0aC5hYnMoeDEgLSB4MCk7XG4gICAgICAgIGNvbnN0IGR5ID0gTWF0aC5hYnMoeTEgLSB5MCk7XG4gICAgICAgIGNvbnN0IHN4ID0gKHgwIDwgeDEpID8gMSA6IC0xO1xuICAgICAgICBjb25zdCBzeSA9ICh5MCA8IHkxKSA/IDEgOiAtMTtcbiAgICAgICAgbGV0IGVyciA9IGR4IC0gZHk7XG5cbiAgICAgICAgd2hpbGUgKHgwKSB7XG4gICAgICAgICAgY29uc3QgZmlsbFggPSBNYXRoLmZsb29yKCh4MCAqIGN0eC5jYW52YXMud2lkdGgpIC8gNTEyKTtcbiAgICAgICAgICBjb25zdCBmaWxsWSA9IE1hdGguZmxvb3IoKHkwICogY3R4LmNhbnZhcy5oZWlnaHQpIC8gNTEyKTtcbiAgICAgICAgICBjdHguZmlsbFJlY3QoZmlsbFgsIGZpbGxZLCAxLCAxKTtcbiAgICAgICAgICBjdHguZmlsbCgpO1xuXG4gICAgICAgICAgaWYgKCh4MCA9PT0geDEpICYmICh5MCA9PT0geTEpKSBicmVhaztcbiAgICAgICAgICBjb25zdCBlMiA9IDIgKiBlcnI7XG4gICAgICAgICAgaWYgKGUyID4gLWR5KSB7IGVyciAtPSBkeTsgeDAgKz0gK3N4OyB9XG4gICAgICAgICAgaWYgKGUyIDwgZHgpIHsgZXJyICs9IGR4OyB5MCArPSArc3k7IH1cbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgbGluZSgpO1xuICAgIH07XG5cbiAgICBjYW52YXMub25tb3VzZXVwID0gbW91c2VVcDtcbiAgfVxuICBpZiAobW91c2UudG9vbCA9PT0gJ2J1Y2tldCcpIHtcbiAgICBjdHguZmlsbFN0eWxlID0gYCR7Y29sb3JzLmN1cnJlbnRDb2xvcn1gO1xuICAgIGN0eC5maWxsUmVjdCgwLCAwLCBjdHguY2FudmFzLndpZHRoLCBjdHguY2FudmFzLmhlaWdodCk7XG4gICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2NhbnZhcycsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwYWxldHRlJykudG9EYXRhVVJMKCkpO1xuICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCd3aWR0aCcsIGN0eC5jYW52YXMud2lkdGgpO1xuICB9XG59O1xuXG5mdW5jdGlvbiBjaGFuZ2VDb2xvcihjb2xvcikge1xuICBjb25zdCBjdXJyID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQnKTtcbiAgY29sb3JzLnByZXZDb2xvciA9IGNvbG9ycy5jdXJyZW50Q29sb3I7XG4gIGNvbnN0IHByZXYgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlvdXMnKTtcbiAgY29sb3JzLmN1cnJlbnRDb2xvciA9IGNvbG9yO1xuICBjdXJyLnN0eWxlLmJhY2tncm91bmQgPSBjb2xvcjtcbiAgcHJldi5zdHlsZS5iYWNrZ3JvdW5kID0gY29sb3JzLnByZXZDb2xvcjtcbiAgcmV0dXJuIChjb2xvcnMuY3VycmVudENvbG9yKTtcbn1cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1ckNvbG9yJykub25pbnB1dCA9ICgpID0+IHtcbiAgY2hhbmdlQ29sb3IoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1ckNvbG9yJykudmFsdWUpO1xufTtcblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY2hhbmdlQ29sb3IoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2N1cnJlbnQnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xufSk7XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdwcmV2aW91cycpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjaGFuZ2VDb2xvcihkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlvdXMnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xufSk7XG5cbmRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZWQnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY2hhbmdlQ29sb3IoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlZCcpLnN0eWxlLmJhY2tncm91bmRDb2xvcik7XG59KTtcblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWUnKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICgpID0+IHtcbiAgY2hhbmdlQ29sb3IoZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2JsdWUnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xufSk7XG5cbmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoJ2tleWRvd24nLCAoZXZlbnQpID0+IHtcbiAgc3dpdGNoIChldmVudC5jb2RlKSB7XG4gICAgY2FzZSAnS2V5Qyc6XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY3VyQ29sb3InKS5jbGljaygpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnS2V5Vic6XG4gICAgICBtb3VzZS50b29sID0gJ3BlbmNpbCc7XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGVuY2lsJykuY2xpY2soKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJ0tleUInOlxuICAgICAgbW91c2UudG9vbCA9ICdidWNrZXQnO1xuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2J1Y2tldCcpLmNsaWNrKCk7XG4gICAgICBicmVhaztcbiAgICBkZWZhdWx0OlxuICAgICAgYnJlYWs7XG4gIH1cbn0pO1xuXG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbG9hZCcpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgYXN5bmMgKCkgPT4ge1xuICBjb25zdCBpbWcgPSBuZXcgSW1hZ2UoKTtcbiAgaW1nLmNyb3NzT3JpZ2luID0gJ2Fub255bW91cyc7XG4gIGNvbnN0IHRvd24gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2VhcmNoJykudmFsdWU7XG4gIGNvbnN0IHVybCA9IGBodHRwczovL2FwaS51bnNwbGFzaC5jb20vcGhvdG9zL3JhbmRvbT9xdWVyeT10b3duLCR7dG93bn0mY2xpZW50X2lkPSR7a2V5fWA7XG4gIGF3YWl0IGZldGNoKHVybClcbiAgICAudGhlbigocmVzKSA9PiByZXMuanNvbigpKVxuICAgIC50aGVuKChkYXRhKSA9PiB7XG4gICAgICBpbWcuc3JjID0gZGF0YS51cmxzLnNtYWxsO1xuICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2ltYWdlJywgaW1nLnNyYyk7XG4gICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICBpZiAoaW1nLndpZHRoID49IGltZy5oZWlnaHQpIHtcbiAgICAgICAgICBjdHguY2FudmFzLndpZHRoID0gaW5wdXQuc2l6ZTtcbiAgICAgICAgICBjb25zdCBoZWlnaHQgPSBpbnB1dC5zaXplICogKGltZy5oZWlnaHQgLyBpbWcud2lkdGgpO1xuICAgICAgICAgIGNvbnN0IHN0YXJ0WSA9IChpbnB1dC5zaXplIC0gaGVpZ2h0KSAvIDI7XG4gICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIDAsIHN0YXJ0WSwgY3R4LmNhbnZhcy53aWR0aCwgaGVpZ2h0KTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FudmFzJywgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbGV0dGUnKS50b0RhdGFVUkwoKSk7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3dpZHRoJywgY3R4LmNhbnZhcy53aWR0aCk7XG4gICAgICAgIH0gZWxzZSB7XG4gICAgICAgICAgY3R4LmNhbnZhcy5oZWlnaHQgPSBpbnB1dC5zaXplO1xuICAgICAgICAgIGNvbnN0IHdpZHRoID0gaW5wdXQuc2l6ZSAqIChpbWcud2lkdGggLyBpbWcuaGVpZ2h0KTtcbiAgICAgICAgICBjb25zdCBzdGFydFggPSAoaW5wdXQuc2l6ZSAtIHdpZHRoKSAvIDI7XG4gICAgICAgICAgY3R4LmRyYXdJbWFnZShpbWcsIHN0YXJ0WCwgMCwgd2lkdGgsIGN0eC5jYW52YXMuaGVpZ2h0KTtcbiAgICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnY2FudmFzJywgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3BhbGV0dGUnKS50b0RhdGFVUkwoKSk7XG4gICAgICAgICAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3dpZHRoJywgY3R4LmNhbnZhcy53aWR0aCk7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgfSk7XG59KTtcblxuY29uc3QgcmFuZ2UgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtcmFuZ2VfX251bWJlcicpO1xuY29uc3QgdmFsdWUgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcuaW5wdXQtcmFuZ2VfX3ZhbHVlJyk7XG5kb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsdWUnKS5pbm5lclRleHQgPSBgJHtpbnB1dC5zaXplfWA7XG5cbnJhbmdlLm9uaW5wdXQgPSBmdW5jdGlvbiAoKSB7XG4gIHN3aXRjaCAoYCR7dGhpcy52YWx1ZX1gKSB7XG4gICAgY2FzZSAnMSc6XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsdWUnKS5pbm5lclRleHQgPSAnNCc7XG4gICAgICB2YWx1ZS5zdHlsZS5sZWZ0ID0gJy0xNXB4JztcbiAgICAgIGlucHV0LnNpemUgPSA0O1xuICAgICAgZHJhd0Zyb21TdG9yYWdlKDQpO1xuICAgICAgYnJlYWs7XG4gICAgY2FzZSAnMic6XG4gICAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgndmFsdWUnKS5pbm5lclRleHQgPSAnIDMyJztcbiAgICAgIHZhbHVlLnN0eWxlLmxlZnQgPSAnMTUwcHgnO1xuICAgICAgaW5wdXQuc2l6ZSA9IDMyO1xuICAgICAgZHJhd0Zyb21TdG9yYWdlKDMyKTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJzMnOlxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhbHVlJykuaW5uZXJUZXh0ID0gJzEyOCc7XG4gICAgICB2YWx1ZS5zdHlsZS5sZWZ0ID0gJzMxNXB4JztcbiAgICAgIGlucHV0LnNpemUgPSAxMjg7XG4gICAgICBkcmF3RnJvbVN0b3JhZ2UoMTI4KTtcbiAgICAgIGJyZWFrO1xuICAgIGNhc2UgJzQnOlxuICAgICAgZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3ZhbHVlJykuaW5uZXJUZXh0ID0gJzI1Nic7XG4gICAgICB2YWx1ZS5zdHlsZS5sZWZ0ID0gJzQ4MHB4JztcbiAgICAgIGlucHV0LnNpemUgPSAyNTY7XG4gICAgICBkcmF3RnJvbVN0b3JhZ2UoMjU2KTtcbiAgICAgIGJyZWFrO1xuICAgIGRlZmF1bHQ6XG4gICAgICBicmVhaztcbiAgfVxufTtcblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ2dyYXlzY2FsZScpLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgKCkgPT4ge1xuICBjb25zdCB3aWR0aCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd3aWR0aCcpO1xuICBjb25zdCBpbWFnZURhdGEgPSBjdHguZ2V0SW1hZ2VEYXRhKDAsIDAsIHdpZHRoLCB3aWR0aCk7XG4gIGNvbnN0IGJsYWNrSW1hZ2UgPSBjdHguY3JlYXRlSW1hZ2VEYXRhKHdpZHRoLCB3aWR0aCk7XG4gIGNvbnN0IHNvdXJjZURhdGEgPSBpbWFnZURhdGEuZGF0YTtcbiAgY29uc3QgYmxhY2tEYXRhID0gYmxhY2tJbWFnZS5kYXRhO1xuICBsZXQgbHVtYTtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBzb3VyY2VEYXRhLmxlbmd0aDsgaSArPSA0KSB7XG4gICAgbHVtYSA9IHNvdXJjZURhdGFbaV0gKiAwLjIxMjYgKyBzb3VyY2VEYXRhW2kgKyAxXSAqIDAuNzE1MiArIHNvdXJjZURhdGFbaSArIDJdICogMC4wNzIyO1xuICAgIGJsYWNrRGF0YVtpXSA9IGx1bWE7XG4gICAgYmxhY2tEYXRhW2kgKyAxXSA9IGx1bWE7XG4gICAgYmxhY2tEYXRhW2kgKyAyXSA9IGx1bWE7XG4gICAgYmxhY2tEYXRhW2kgKyAzXSA9IHNvdXJjZURhdGFbaSArIDNdO1xuICB9XG4gIGN0eC5wdXRJbWFnZURhdGEoYmxhY2tJbWFnZSwgMCwgMCk7XG4gIGxvY2FsU3RvcmFnZS5zZXRJdGVtKCdjYW52YXMnLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncGFsZXR0ZScpLnRvRGF0YVVSTCgpKTtcbn0pO1xuXG5cbmlmIChsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbW91c2UnKSAhPT0gbnVsbCAmJiB3aW5kb3cuY29uZmlybSgn0JLQvtGB0YHRgtCw0L3QvtCy0LjRgtGMINC00LDQvdC90YvQtSDQv9GA0LXQtNGL0LTRg9GJ0LXQuSDRgdC10YHRgdC40Lg/JykpIHtcbiAgY29uc3Qgd2lkdGggPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnd2lkdGgnKTtcbiAgY29uc3QgZGF0YVVSTCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjYW52YXMnKTtcbiAgY29uc3QgaW1nRGF0YSA9IG5ldyBJbWFnZSgpO1xuICBpbWdEYXRhLnNyYyA9IGRhdGFVUkw7XG4gIGltZ0RhdGEub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoO1xuICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aDtcbiAgICBjdHguZHJhd0ltYWdlKGltZ0RhdGEsIDAsIDApO1xuICB9O1xuXG4gIG1vdXNlLnRvb2wgPSBsb2NhbFN0b3JhZ2UuZ2V0SXRlbSgnbW91c2UnKTtcbiAgY2hhbmdlQ29sb3IobG9jYWxTdG9yYWdlLmdldEl0ZW0oJ3ByZXZpb3VzQ29sb3InKSk7XG4gIGNoYW5nZUNvbG9yKGxvY2FsU3RvcmFnZS5nZXRJdGVtKCdjdXJyZW50Q29sb3InKSk7XG4gIGRvY3VtZW50LmJvZHkuc3R5bGUuY3Vyc29yID0gYHVybCgnLi9zcmMvYmxvY2tzL21haW4vJHttb3VzZS50b29sfS5zdmcnKSwgYXV0b2A7XG4gIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKG1vdXNlLnRvb2wpLnBhcmVudE5vZGUuY2xhc3NOYW1lID0gJ2xpc3RfX2l0ZW0gYWN0aXZlJztcbiAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignLm1haW5fX2NhbnZhcycpLnN0eWxlLmltYWdlUmVuZGVyaW5nID0gJ3BpeGVsYXRlZCc7XG59XG5cbndpbmRvdy5vbnVubG9hZCA9IGZ1bmN0aW9uIHVubG9hZGVyKCkge1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnbW91c2UnLCBtb3VzZS50b29sKTtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ2N1cnJlbnRDb2xvcicsIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdjdXJyZW50Jykuc3R5bGUuYmFja2dyb3VuZENvbG9yKTtcbiAgbG9jYWxTdG9yYWdlLnNldEl0ZW0oJ3ByZXZpb3VzQ29sb3InLCBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgncHJldmlvdXMnKS5zdHlsZS5iYWNrZ3JvdW5kQ29sb3IpO1xuICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnaW5wdXQtcmFuZ2UnLCBpbnB1dC5zaXplKTtcbn07XG5cblxuZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoYCR7bW91c2UudG9vbH1gKS5jbGljaygpO1xuXG4vLyBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdtZW51X19idXR0b24nKS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsICAoKSA9PiB7XG4vL1xuLy8gfSk7XG4iXSwic291cmNlUm9vdCI6IiJ9